<div class="denuncias-container" role="region" aria-label="Gesti√≥n de denuncias">
  <header class="denuncias-header" role="banner">
    <div class="header-main">
      <h1 class="header-title">üö® Denuncias</h1>
      <p class="header-subtitle">
        Panel de administraci√≥n para revisar denuncias sobre rese√±as y solicitudes.
      </p>
    </div>

    <div class="header-actions">
      <button class="btn btn-refresh"
              type="button"
              (click)="refresh()"
              aria-label="Actualizar denuncias">
        üîÑ Actualizar
      </button>
    </div>
  </header>

  <section class="section denuncias-card" aria-label="Panel de denuncias">
    <nav class="tabs-simple" role="tablist" aria-label="Tipos de denuncias">
      <button
        id="tab-resenas"
        role="tab"
        class="tab-btn-simple"
        [class.active]="activeTab === 'resenas'"
        [attr.aria-selected]="activeTab === 'resenas'"
        attr.aria-controls="panel-resenas"
        type="button"
        (click)="setActiveTab('resenas')">
        ‚≠ê Denuncias sobre rese√±as
      </button>

      <button
        id="tab-servicios"
        role="tab"
        class="tab-btn-simple"
        [class.active]="activeTab === 'servicios'"
        [attr.aria-selected]="activeTab === 'servicios'"
        attr.aria-controls="panel-servicios"
        type="button"
        (click)="setActiveTab('servicios')">
        üõ†Ô∏è Denuncias sobre servicios
      </button>
    </nav>

    <div
      id="panel-resenas"
      role="tabpanel"
      aria-labelledby="tab-resenas"
      class="tab-panel-simple"
      [hidden]="activeTab !== 'resenas'">

      <div class="empty-simple" *ngIf="loadingResenas">
        <div class="empty-emoji">‚è≥</div>
        <p>Cargando denuncias sobre rese√±as‚Ä¶</p>
      </div>

      <div class="empty-simple" *ngIf="!loadingResenas && errorResenas">
        <div class="empty-emoji">‚ö†Ô∏è</div>
        <p>{{ errorResenas }}</p>
      </div>

      <div class="list-simple" *ngIf="!loadingResenas && !errorResenas">
        <article class="denuncia-row"
                 *ngFor="let d of denunciasResenas"
                 aria-label="Denuncia sobre rese√±a">
          <div class="denuncia-col main">
            <div class="denuncia-badge">Rese√±a #{{ d.idValorizacion }}</div>
            <div class="denuncia-title">
              {{ d.resenaComentario || 'Sin comentario en la rese√±a' }}
            </div>
            <div class="denuncia-meta">
              <span>‚≠ê {{ d.resenaCantEstrellas }} / 5</span>
              <span>Autor rese√±a: {{ d.resenaAutorNombre || ('Usuario #' + d.resenaAutorId) }}</span>
              <span>Fecha rese√±a: {{ d.resenaFecha | date:'dd/MM/yyyy' }}</span>
            </div>
          </div>

          <div class="denuncia-col motivo">
            <div class="denuncia-label">Motivo de denuncia</div>
            <div class="denuncia-motivo">{{ d.motivo }}</div>
            <div class="denuncia-meta">
              Denunciante: {{ d.denuncianteNombre || ('Usuario #' + d.idUsuarioDenunciante) }}
            </div>
          </div>

          <div class="denuncia-col actions">
            <button class="action-chip btn-danger"
                    type="button"
                    (click)="eliminarResena(d)"
                    title="Eliminar rese√±a denunciada">
              üóëÔ∏è Eliminar rese√±a
            </button>
            <button class="action-chip btn-soft"
                    type="button"
                    (click)="marcarResuelta(d)">
              ‚úÖ Marcar resuelta
            </button>
          </div>
        </article>

        <div class="empty-simple" *ngIf="denunciasResenas.length === 0">
          <div class="empty-emoji">‚ú®</div>
          <h3>No hay denuncias sobre rese√±as</h3>
          <p>Cuando los usuarios reporten rese√±as, aparecer√°n aqu√≠.</p>
        </div>
      </div>
    </div>

    <div
      id="panel-servicios"
      role="tabpanel"
      aria-labelledby="tab-servicios"
      class="tab-panel-simple"
      [hidden]="activeTab !== 'servicios'">

      <div class="empty-simple" *ngIf="loadingServicios">
        <div class="empty-emoji">‚è≥</div>
        <p>Cargando denuncias sobre servicios‚Ä¶</p>
      </div>

      <div class="empty-simple" *ngIf="!loadingServicios && errorServicios">
        <div class="empty-emoji">‚ö†Ô∏è</div>
        <p>{{ errorServicios }}</p>
      </div>

      <div class="list-simple" *ngIf="!loadingServicios && !errorServicios">
        <article class="denuncia-row"
                 *ngFor="let d of denunciasServicios"
                 aria-label="Denuncia sobre servicio">
          <div class="denuncia-col main">
            <div class="denuncia-badge">Servicio #{{ d.idServicio }}</div>
            
            <div style="display: flex; gap: 12px; margin-top: 8px; align-items: flex-start;">
              
              <img *ngIf="d.fotoServicioUrl" 
                   [src]="d.fotoServicioUrl" 
                   alt="Foto servicio" 
                   style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px; border: 1px solid #ccc; flex-shrink: 0;">
              
              <div *ngIf="!d.fotoServicioUrl" 
                   style="width: 60px; height: 60px; background: #eee; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: #999; flex-shrink: 0;">
                üõ†Ô∏è
              </div>

              <div>
                <div class="denuncia-title">
                  {{ d.servicioTitulo || 'Servicio sin t√≠tulo' }}
                </div>
                <div class="denuncia-meta" style="display: flex; flex-direction: column; gap: 2px;">
                  <span>Categor√≠a: {{ d.servicioCategoria || 'Sin categor√≠a' }}</span>
                  <span>Proveedor: {{ d.proveedorNombre || ('Usuario #' + d.proveedorId) }}</span>
                </div>
              </div>

            </div>
          </div>

          <div class="denuncia-col motivo">
            <div class="denuncia-label">Motivo de denuncia</div>
            <div class="denuncia-motivo">{{ d.motivo }}</div>
            <div class="denuncia-meta">
              Denunciante: {{ d.denuncianteNombre || ('Usuario #' + d.idUsuarioDenunciante) }}
            </div>
          </div>

          <div class="denuncia-col actions">
            <button class="action-chip btn-detail"
                    type="button"
                    (click)="verDetalleServicio(d)">
              üîç Ver servicio
            </button>
            <button class="action-chip btn-danger"
                    type="button"
                    (click)="accionSobreServicio(d)">
              ‚ö†Ô∏è Acci√≥n sobre servicio
            </button>
            <button class="action-chip btn-soft"
                    type="button"
                    (click)="marcarResuelta(d)">
              ‚úÖ Marcar resuelta
            </button>
          </div>
        </article>

        <div class="empty-simple" *ngIf="denunciasServicios.length === 0">
          <div class="empty-emoji">üì≠</div>
          <h3>No hay denuncias sobre servicios</h3>
          <p>Cuando los usuarios reporten servicios, aparecer√°n aqu√≠.</p>
        </div>
      </div>
    </div>

  </section>
</div>

<app-servicio-detalle-modal
  *ngIf="selectedService"
  [servicio]="selectedService"
  (close)="closeServiceModal()">
</app-servicio-detalle-modal>