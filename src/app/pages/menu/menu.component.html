<!-- BotÃ³n para mostrar/ocultar sidebar -->
<button 
  [class]="toggleButtonClasses"
  [title]="toggleTitle"
  (click)="toggleSidebar()">
  {{ toggleIcon }}
</button>

<!-- Barra lateral de perfil -->
<aside [class]="sidebarClasses">
  <br>
  <br>
    <div class="welcome-section">
        <!-- Titulo -->
        <h2 class="welcome-title">Bienvenido Usuario</h2>
        
        <!-- Foto Perfil CON FUNCIONALIDAD -->
        <div class="profile-photo" (click)="openPhotoModal()">
          <!-- Imagen si existe -->
          <img 
            *ngIf="hasProfileImage" 
            [src]="profileImageUrl" 
            alt="Foto de perfil">
          <!-- Iniciales si no hay imagen -->
          <span *ngIf="!hasProfileImage" id="profileInitials">{{ userInitials }}</span>
          <!-- Overlay de cÃ¡mara -->
          <div class="camera-overlay">ğŸ“·</div>
        </div>
        
        <!-- Nombre de Usuario -->
        <div class="user-name">{{ userName }}</div>

        <!-- ClasificaciÃ³n dinÃ¡mica -->
        <div class="rating-section">
            <div class="stars">
                <!-- Mostrar estrellas dinÃ¡micamente -->
                <ng-container *ngIf="userRating !== null && userRating > 0; else noRating">
                <ng-container *ngFor="let star of [1,2,3,4,5]">
                    <span *ngIf="userRating >= star">â˜…</span>
                    <span *ngIf="userRating < star && userRating >= star - 0.5">â¯¨</span>
                    <span *ngIf="userRating < star - 0.5">â˜†</span>
                </ng-container>
                </ng-container>

                <!-- Si no hay evaluaciÃ³n -->
                <ng-template #noRating>
                <span>â˜†â˜†â˜†â˜†â˜†</span>
                </ng-template>
            </div>

            <span class="rating-text">
                {{ userRating !== null ? (userRating | number:'1.1-1') : '0.0' }}
            </span>
        </div>

    </div>

    <!-- DescripciÃ³n -->
    <div class="description-section">
        <h3 class="section-title">DescripciÃ³n</h3>
        <p class="description-text">
            {{ userDescription || 'â€”' }}
        </p>
    </div>

    <!-- Recomendaciones -->
    <div class="reviews-section">
        <h3 class="section-title">Recomendaciones</h3>
        <div class="review-item">
            <div class="review-author">Elena Nito</div>
            <p class="review-text">"Excelente trabajo en mi jardÃ­n. Muy profesional y puntual."</p>
        </div>
        <div class="review-item">
            <div class="review-author">Armando Casas</div>
            <p class="review-text">"Recomiendo 100%. TransformÃ³ completamente mi patio."</p>
        </div>
    </div>

    <!-- Btns de AcciÃ³n -->
    <div class="action-buttons">
        <button class="action-btn btn-primary" (click)="routePerfil()">âœï¸ Editar Perfil</button>
        <button *ngIf="isProveedor" class="action-btn btn-success" (click)="routeRegistrarServicio()">â• Publicar Servicio</button>
        <button class="action-btn btn-secondary">ğŸ“· Subir Fotos</button>
        <button class="action-btn btn-danger" (click)="openLogoutModal()">ğŸšª Cerrar SesiÃ³n</button>
    </div>
</aside>

<!-- MODAL PARA SELECCIONAR FOTO -->
<div *ngIf="photoModalVisible" class="modal" (click)="onModalBackdropClick($event)">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <span class="close" (click)="closePhotoModal()">&times;</span>
    <h3>Cambiar foto de perfil</h3>
    <button (click)="takePhoto()">ğŸ“· Tomar foto</button>
    <button (click)="uploadPhoto()">ğŸ“ Subir archivo</button>
    <button *ngIf="hasProfileImage" (click)="removePhoto()" style="background: #f44336;">ğŸ—‘ï¸ Eliminar foto</button>
  </div>
</div>

<!-- MODAL DE CÃMARA -->
<div *ngIf="cameraModalVisible" class="camera-modal" (click)="onCameraBackdropClick($event)">
  <div class="camera-container" (click)="$event.stopPropagation()">
    <div class="camera-header">
      <h3>Tomar foto</h3>
      <button class="close-camera" (click)="closeCameraModal()">&times;</button>
    </div>
    
    <div class="camera-content">
      <video id="cameraVideo" autoplay playsinline muted></video>
      <canvas id="photoCanvas" style="display: none;"></canvas>
    </div>
    
    <div class="camera-controls">
      <button class="camera-btn switch-btn" (click)="switchCamera()" title="Cambiar cÃ¡mara">
        Cambiar CÃ¡mara
      </button>
      <button class="camera-btn capture-btn" (click)="capturePhoto()" title="Capturar foto">
        TOMAR FOTO
      </button>
      <button class="camera-btn cancel-btn" (click)="closeCameraModal()" title="Cancelar">
        Cancelar
      </button>
    </div>
  </div>
</div>

<!-- INPUTS OCULTOS PARA MANEJO DE ARCHIVOS -->
<input 
  type="file" 
  id="cameraInput" 
  accept="image/*" 
  capture="camera" 
  style="display: none;" 
  (change)="handlePhotoUpload($event)">

<input 
  type="file" 
  id="fileInput" 
  accept="image/*" 
  style="display: none;" 
  (change)="handlePhotoUpload($event)">

<!-- Contenido principal -->
<main [class]="mainContentClasses">
    <div class="platform-container">
        <header class="platform-header">
            <div class="logo">
                <div class="logo-icon">ğŸ”</div>
                <h1 class="logo-text">EL DATO</h1>
            </div>
        </header>

        <!-- Barra de busqueda -->
        <section class="search-section">
            <div class="search-bar">
                <input type="text" placeholder="Â¿QuÃ© Dato necesitas hoy?" id="searchInput">
                <button class="search-btn" (click)="buscarServicio()">Buscar</button>
            </div>
        </section>

        <section class="services-grid">
            <!-- Loading / error -->
            <div *ngIf="categoriasLoading" class="service-card" style="opacity:.7; pointer-events:none;">
                <div class="service-icon">â³</div>
                <h3 class="service-title">Cargando categorÃ­as...</h3>
                <p class="service-description">Espera un momento</p>
            </div>

            <div *ngIf="!categoriasLoading && categoriasError" class="service-card" style="border-color:#f44336;">
                <div class="service-icon">âš ï¸</div>
                <h3 class="service-title">Error</h3>
                <p class="service-description">{{ categoriasError }}</p>
            </div>

            <!-- Listado dinÃ¡mico -->
            <div
                class="service-card"
                *ngFor="let cat of categorias"
                (click)="seleccionarCategoria(cat)"
                title="Ver servicios cercanos en {{cat.nombre}}">
                <div class="service-icon">ğŸ§©</div>
                <h3 class="service-title">{{ cat.nombre }}</h3>
                <p class="service-description">{{ cat.descripcion || 'â€”' }}</p>
            </div>
        </section>
        
        <section *ngIf="serviciosLoading" class="recent-searches">
            <h3 class="recent-title">Buscando servicios cercanos...</h3>
        </section>

        <section *ngIf="!serviciosLoading && !serviciosError && serviciosDeCategoria && serviciosDeCategoria.length === 0" class="recent-searches">
            <h3 class="recent-title">Sin resultados</h3>
            <div class="search-item">
                <div class="search-item-icon">ğŸ˜”</div>
                <span class="search-item-text">
                No encontramos servicios en esta categorÃ­a cerca de ti por ahora.
                Intenta con otra categorÃ­a o vuelve a intentarlo mÃ¡s tarde.
                </span>
            </div>
        </section>

        <section *ngIf="!serviciosLoading && serviciosDeCategoria?.length" class="recent-searches">
            <h3 class="recent-title">Servicios cercanos</h3>
            <div class="search-item" *ngFor="let s of serviciosDeCategoria">
                <div class="search-item-icon">ğŸ”</div>
                <span class="search-item-text">
                {{ s.titulo }} â€” {{ s.categoriaNombre || ('Cat #' + s.idCategoriaServicio) }}
                <ng-container *ngIf="s.proveedorNombre"> Â· por {{ s.proveedorNombre }}</ng-container>
                <ng-container *ngIf="s.precioBase"> Â· $ {{ s.precioBase | number:'1.0-0' }}</ng-container>
                </span>
            </div>
        </section>

        <section class="recent-searches">
            <h3 class="recent-title">BÃºsquedas Recientes</h3>
            <div class="search-item" (click)="buscarReciente('jardineria')">
                <div class="search-item-icon">ğŸŒ±</div>
                <span class="search-item-text">JardinerÃ­a en mi zona</span>
            </div>
            <div class="search-item" (click)="buscarReciente('limpieza')">
                <div class="search-item-icon">ğŸ§¹</div>
                <span class="search-item-text">Limpieza semanal</span>
            </div>
            <div class="search-item" (click)="buscarReciente('plomeria')">
                <div class="search-item-icon">ğŸ”§</div>
                <span class="search-item-text">Plomero urgente</span>
            </div>
        </section>
    </div>
</main>

<!-- MODAL DE CONFIRMACIÃ“N PARA CERRAR SESIÃ“N -->
<div *ngIf="logoutModalVisible" class="logout-modal-overlay" (click)="closeLogoutModal()">
    <div class="logout-modal-content" (click)="$event.stopPropagation()">
        <div class="logout-modal-header">
            <div class="logout-modal-icon">
                <span class="logout-icon">ğŸšª</span>
            </div>
            <button class="close-logout-btn" (click)="closeLogoutModal()">Ã—</button>
        </div>
        
        <div class="logout-modal-body">
            <h3>Â¿Cerrar SesiÃ³n?</h3>
            <p>Â¿EstÃ¡s seguro de que deseas cerrar tu sesiÃ³n?</p>
            <p class="logout-warning">TendrÃ¡s que iniciar sesiÃ³n nuevamente para acceder a tu cuenta.</p>
        </div>
        
        <div class="logout-modal-footer">
            <button class="logout-btn-cancel" (click)="closeLogoutModal()">
                Cancelar
            </button>
            <button class="logout-btn-confirm" (click)="confirmLogout()">
                SÃ­, Cerrar SesiÃ³n
            </button>
        </div>
    </div>
</div>
