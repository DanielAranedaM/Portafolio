<div class="rs-bg">
  <div class="rs-container">
    
    <!-- Header principal prominente -->
    <div class="rs-header">
      <span class="rs-icon">üõ†Ô∏è</span>
      <h1>Registrar Servicio</h1>
      <p class="rs-subtitle">Publica tu servicio en 3 pasos simples y claros</p>
    </div>

    <!-- Stepper horizontal prominente -->
    <div class="rs-stepper-wide">
      <div class="step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">
        <span class="step-number">1</span>
        <span class="step-label">Informaci√≥n B√°sica</span>
        <div class="step-line"></div>
      </div>
      <div class="step" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2">
        <span class="step-number">2</span>
        <span class="step-label">Detalles del Servicio</span>
        <div class="step-line"></div>
      </div>
      <div class="step" [class.active]="currentStep >= 3" [class.completed]="currentStep > 3">
        <span class="step-number">3</span>
        <span class="step-label">Im√°genes y Ubicaci√≥n</span>
      </div>
    </div>

    <!-- Formulario distribuido -->
    <form [formGroup]="form" (ngSubmit)="submit()" class="rs-form-wide">
      
      <!-- PASO 1: Informaci√≥n B√°sica -->
      <section *ngIf="currentStep === 1" class="rs-section">
        <h2 class="rs-section-title">
          <i class="bi bi-info-circle"></i>
          Informaci√≥n B√°sica del Servicio
        </h2>
        
        <div class="rs-row">
          <div class="rs-col">
            <label for="nombreServicio" class="form-label-xl">¬øCu√°l es el nombre de tu servicio?</label>
            <input 
              type="text" 
              class="form-control-xl" 
              id="nombreServicio" 
              formControlName="nombreServicio" 
              placeholder="Ejemplo: Limpieza del hogar, Jardiner√≠a, Plomer√≠a"
            >
            <div *ngIf="form.get('nombreServicio')?.invalid && form.get('nombreServicio')?.touched" class="text-danger">
              <i class="bi bi-exclamation-circle"></i> 
              El nombre del servicio es requerido (m√≠nimo 3 caracteres)
            </div>
          </div>
          
          <div class="rs-col">
            <label for="categoria" class="form-label-xl">¬øA qu√© categor√≠a pertenece?</label>
            <select class="form-select-xl" id="categoria" formControlName="categoria">
              <option value="">Selecciona la categor√≠a m√°s adecuada</option>
              <option *ngFor="let c of categorias" [value]="c.idCategoriaServicio">
                {{ c.nombre }}
              </option>
            </select>
            <div *ngIf="cargandoCategorias" class="text-muted">Cargando categor√≠as disponibles...</div>
            <div *ngIf="form.get('categoria')?.invalid && form.get('categoria')?.touched" class="text-danger">
              <i class="bi bi-exclamation-circle"></i> 
              Debes seleccionar una categor√≠a
            </div>
          </div>
        </div>
      </section>

      <!-- PASO 2: Detalles del Servicio -->
      <section *ngIf="currentStep === 2" class="rs-section">
        <h2 class="rs-section-title">
          <i class="bi bi-list-check"></i>
          Detalles de tu Servicio
        </h2>
        
        <!-- Panel de ayuda arriba, visible para todos -->
        <div class="rs-tip-panel">
          <div class="rs-tip-title">
            <i class="bi bi-lightbulb"></i>
            Consejos para una buena descripci√≥n
          </div>
          <div class="rs-tip-content">
            <ul class="rs-tip-list">
              <li>Usa palabras simples y claras</li>
              <li>Explica qu√© incluye y qu√© no incluye</li>
              <li>Menciona precios por diferentes tama√±os</li>
              <li>Indica si llevas materiales o herramientas</li>
              <li>Se√±ala tiempo estimado de trabajo</li>
              <li>Especifica tu radio de atenci√≥n</li>
            </ul>
            
            <div class="rs-examples">
              <strong>Ejemplo para Corte de Pasto:</strong>
              <ul>
                <li>Jard√≠n peque√±o (hasta 50m¬≤): $15.000</li>
                <li>Jard√≠n mediano (hasta 100m¬≤): $25.000</li>
                <li>Jard√≠n grande (m√°s de 100m¬≤): precio a conversar</li>
              </ul>
              <small>Incluye orillado y barrido. No incluye retiro de residuos.</small>
            </div>
          </div>
        </div>
        
        <!-- √Årea de texto centrada y prominente -->
        <div class="rs-row">
          <div class="rs-col">
            <label for="descripcion" class="form-label-xl">Describe tu servicio en detalle</label>
            <textarea
              class="form-control-xl rs-textarea-xl"
              id="descripcion"
              formControlName="descripcion"
              placeholder="Explica qu√© incluye tu servicio, materiales que usas, tiempo que tomas, precios por diferentes tama√±os, etc."
            ></textarea>
            <div class="rs-char-counter">
              {{ (form.value.descripcion?.length || 0) }} caracteres escritos
              <br><small>Recomendamos escribir entre 120-300 caracteres para una mejor descripci√≥n</small>
            </div>
            <div *ngIf="form.get('descripcion')?.invalid && form.get('descripcion')?.touched" class="text-danger">
              <i class="bi bi-exclamation-circle"></i> 
              La descripci√≥n es requerida (m√≠nimo 10 caracteres)
            </div>
          </div>
        </div>
      </section>

      <!-- PASO 3: Im√°genes y Ubicaci√≥n -->
      <section *ngIf="currentStep === 3" class="rs-section">
        <h2 class="rs-section-title">
          <i class="bi bi-image"></i>
          Im√°genes y Ubicaci√≥n
        </h2>
        
        <div class="rs-row">
          <div class="rs-col">
            <label for="ubicacion" class="form-label-xl">¬øD√≥nde prestas tu servicio?</label>
            <input
              type="text"
              class="form-control-xl"
              id="ubicacion"
              autocomplete="off"
              placeholder="Escribe tu direcci√≥n o zona de trabajo"
              [value]="form.value.direccionDescripcion || ''"
              (input)="onDireccionInput($any($event.target).value)"
            />
            <small class="text-muted">Puedes usar tu direcci√≥n guardada o escribir una nueva zona de trabajo</small>
          </div>
          
          <div class="rs-col">
            <label for="imagenes" class="form-label-xl">Fotos de tu trabajo</label>
            <div class="rs-file-area">
              <i class="bi bi-images" style="font-size: 3rem; color: #007bff; margin-bottom: 1rem; display: block;"></i>
              <input
                type="file"
                class="form-control-xl"
                id="imagenes"
                multiple
                accept="image/*"
                (change)="onFileSelected($event)"
              />
              <small class="text-muted">Selecciona hasta 5 fotos de trabajos anteriores</small>
            </div>
            
            <div *ngIf="selectedFiles.length > 0" class="rs-img-preview">
              <div *ngFor="let file of selectedFiles; let i = index" class="rs-img-item">
                <span class="rs-img-name">
                  <i class="bi bi-file-image"></i> 
                  {{ file.name }}
                </span>
                <span class="rs-img-size">
                  ({{ (file.size / 1024 / 1024).toFixed(2) }} MB)
                </span>
                <button 
                  type="button" 
                  class="btn btn-sm btn-outline-danger" 
                  (click)="removeFile(i)"
                >
                  <i class="bi bi-trash"></i> Quitar
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Resumen final -->
        <div class="rs-resumen-wide">
          <h3 class="rs-resumen-title">
            <i class="bi bi-clipboard-check"></i>
            Resumen de tu servicio
          </h3>
          <div class="rs-resumen-grid">
            <div class="rs-resumen-item">
              <i class="bi bi-pencil"></i>
              <strong>Servicio:</strong><br>
              {{ form.value.nombreServicio || 'No especificado' }}
            </div>
            <div class="rs-resumen-item">
              <i class="bi bi-tags"></i>
              <strong>Categor√≠a:</strong><br>
              {{ getCategoriaName(form.value.categoria) || 'No seleccionada' }}
            </div>
            <div class="rs-resumen-item">
              <i class="bi bi-card-text"></i>
              <strong>Descripci√≥n:</strong><br>
              {{ (form.value.descripcion || 'Sin descripci√≥n').substring(0, 100) }}{{ (form.value.descripcion || '').length > 100 ? '...' : '' }}
            </div>
            <div class="rs-resumen-item">
              <i class="bi bi-geo-alt"></i>
              <strong>Ubicaci√≥n:</strong><br>
              {{ form.value.direccionDescripcion || 'No especificada' }}
            </div>
            <div class="rs-resumen-item">
              <i class="bi bi-images"></i>
              <strong>Fotos:</strong><br>
              {{ selectedFiles.length }} imagen{{ selectedFiles.length !== 1 ? 'es' : '' }} seleccionada{{ selectedFiles.length !== 1 ? 's' : '' }}
            </div>
          </div>
        </div>
      </section>

      <!-- Navegaci√≥n prominente -->
      <div class="rs-nav-wide">
        <button 
          type="button" 
          class="btn btn-secondary btn-xl" 
          (click)="prevStep()" 
          [disabled]="currentStep === 1"
        >
          <i class="bi bi-arrow-left"></i> Paso Anterior
        </button>
        
        <button 
          type="button" 
          class="btn btn-primary btn-xl" 
          (click)="nextStep()" 
          [disabled]="!isStepValid(currentStep)" 
          *ngIf="currentStep < totalSteps"
        >
          Siguiente Paso <i class="bi bi-arrow-right"></i>
        </button>
        
        <button 
          type="submit" 
          class="btn btn-success btn-xl" 
          [disabled]="!form.valid || isSubmitting" 
          *ngIf="currentStep === totalSteps"
        >
          <span *ngIf="!isSubmitting">
            <i class="bi bi-check-circle"></i> Publicar Servicio
          </span>
          <span *ngIf="isSubmitting">
            <i class="bi bi-hourglass-split"></i> Publicando... {{ uploadProgress }}%
          </span>
        </button>

        <!-- Indicador de progreso -->
        <div *ngIf="isSubmitting" class="upload-progress-container">
          <div class="upload-progress-bar" [style.width.%]="uploadProgress"></div>
        </div>
      </div>
      
    </form>
  </div>
</div>