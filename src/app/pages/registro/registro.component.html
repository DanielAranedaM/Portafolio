<div class="registro-container">
  <div><h1 class="welcome-title">REGÍSTRATE</h1></div>

  <form class="login-form" [formGroup]="form" (ngSubmit)="onSubmit()">
    <!-- Nombre -->
    <div class="form-group">
      <label class="form-label">Nombre *</label>
      <div class="input-container">
        <span class="input-icon">👤</span>
        <input type="text" class="form-input" placeholder="Nombre Completo"
               formControlName="nombre" [class.invalid]="invalid('nombre')" required>
      </div>
      <div class="error-text" *ngIf="invalid('nombre')">El nombre es obligatorio.</div>
    </div>

    <!-- Fecha de nacimiento -->
    <div class="form-group">
      <label class="form-label">Fecha de nacimiento *</label>
      <div class="input-container">
        <span class="input-icon">🎂</span>
        <input type="date" class="form-input" placeholder="AAAA-MM-DD"
               formControlName="fechaNacimiento" [attr.max]="today"
               [class.invalid]="invalid('fechaNacimiento')" required>
      </div>
      <div class="error-text" *ngIf="invalid('fechaNacimiento')">
        La fecha de nacimiento es obligatoria y no puede ser futura.
      </div>
    </div>

    <!-- Dirección con autocompletado -->
    <div class="form-group" style="position: relative;">
      <label class="form-label">Dirección *</label>
      <div class="input-container">
        <span class="input-icon">📍</span>
        <input #direccionInput type="text" class="form-input" placeholder="Escribe tu dirección"
               autocomplete="off"
               (keydown.enter)="$event.preventDefault()"
               (input)="onDireccionInput(direccionInput.value)"
               (focus)="abrirSugerenciasSiHay()"
               (blur)="onDireccionBlur()"
               [value]="form.value.direccionDescripcion || ''"
               [class.invalid]="invalid('direccionDescripcion')" required>
      </div>
      <div class="error-text" *ngIf="invalid('direccionDescripcion')">La dirección es obligatoria.</div>

      <ul class="sugerencias" *ngIf="mostrandoSugerencias">
        <li class="sugerencia-item" *ngFor="let s of sugerencias"
            (mousedown)="seleccionarSugerencia(s, direccionInput)">
          {{ s.display_name }}
        </li>
        <li class="sugerencia-atribucion">
          Resultados por Nominatim — © OpenStreetMap contributors
        </li>
      </ul>
    </div>

    <!-- Correo -->
    <div class="form-group">
      <label class="form-label">Correo electrónico *</label>
      <div class="input-container">
        <span class="input-icon">📧</span>
        <input type="email" class="form-input" placeholder="tu@correo.com"
               formControlName="correo" [class.invalid]="invalid('correo')" required>
      </div>
      <div class="error-text" *ngIf="invalid('correo')">Ingresa un correo válido.</div>
    </div>

    <!-- Teléfono (opcional) -->
    <div class="form-group">
      <label class="form-label">Teléfono (opcional)</label>
      <div class="input-container">
        <span class="input-icon">📱</span>
        <input type="tel" class="form-input" placeholder="+56 9 1234 5678"
               formControlName="telefono">
      </div>
    </div>

    <!-- Passwords (grupo) -->
    <div formGroupName="passwordGroup">
      <div class="form-group">
        <label class="form-label">Contraseña *</label>
        <div class="input-container">
          <span class="input-icon">🔒</span>
          <input [type]="showPass ? 'text' : 'password'" class="form-input"
                 placeholder="Contraseña" formControlName="password" id="passwordInput"
                 [class.invalid]="form.get('passwordGroup.password')?.invalid && (form.get('passwordGroup.password')?.touched || form.get('passwordGroup.password')?.dirty)" required>
          <button type="button" class="password-toggle" (click)="togglePassword()">
            {{ showPass ? '🙈' : '👁' }}
          </button>
        </div>
        <div class="error-text"
             *ngIf="form.get('passwordGroup.password')?.invalid && (form.get('passwordGroup.password')?.touched || form.get('passwordGroup.password')?.dirty)">
          La contraseña es obligatoria (mínimo 6 caracteres).
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Repetir contraseña *</label>
        <div class="input-container">
          <span class="input-icon">🔒</span>
          <input [type]="showPass2 ? 'text' : 'password'" class="form-input"
                 placeholder="Repetir Contraseña" formControlName="repeatPassword" id="passwordRepeatInput"
                 [class.invalid]="(form.get('passwordGroup.repeatPassword')?.touched || form.get('passwordGroup.repeatPassword')?.dirty) && !passwordsMatch" required>
          <button type="button" class="password-toggle" (click)="togglePassword2()">
            {{ showPass2 ? '🙈' : '👁' }}
          </button>
        </div>
        <div class="error-text"
             *ngIf="form.get('passwordGroup')?.touched && form.get('passwordGroup')?.errors?.['passwordsMismatch']">
          Las contraseñas no coinciden.
        </div>
      </div>
    </div>

    <!-- Tipo de usuario -->
    <div class="tipo-usuario-container">
      <label>Tipo de Usuario *:</label>
      <div class="form-check">
        <input class="form-check-input" type="radio" formControlName="tipoUsuario" value="proveedor" id="radioDefault1">
        <label class="form-check-label" for="radioDefault1">Proveedor</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" formControlName="tipoUsuario" value="solicitante" id="radioDefault2">
        <label class="form-check-label" for="radioDefault2">Solicitante</label>
      </div>
    </div>

    <br>
    <button type="submit" class="login-button" [disabled]="form.invalid">Registrarme</button>
    <br><br>
    <button type="button" class="cancel-button" (click)="routeLogin()">Cancelar</button>
  </form>
</div>
