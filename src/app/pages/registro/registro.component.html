<div class="registro-container">
  <div><h1 class="welcome-title">REGÃSTRATE</h1></div>

  <form class="login-form" [formGroup]="form" (ngSubmit)="onSubmit()">
    <!-- Nombre -->
    <div class="form-group">
      <label class="form-label">Nombre *</label>
      <div class="input-container">
        <span class="input-icon">ğŸ‘¤</span>
        <input type="text" class="form-input" placeholder="Nombre Completo"
               formControlName="nombre" [class.invalid]="invalid('nombre')" required>
      </div>
      <div class="error-text" *ngIf="invalid('nombre')">El nombre es obligatorio.</div>
    </div>

    <!-- Fecha de nacimiento -->
    <div class="form-group">
      <label class="form-label">Fecha de nacimiento *</label>
      <div class="input-container">
        <span class="input-icon">ğŸ‚</span>
        <input type="date" class="form-input" placeholder="AAAA-MM-DD"
               formControlName="fechaNacimiento" 
               [attr.max]="maxDateAllowed"
               [class.invalid]="invalid('fechaNacimiento')" required>
      </div>
      
      <div class="error-text" *ngIf="invalid('fechaNacimiento')">
        <span *ngIf="form.get('fechaNacimiento')?.errors?.['required']">
          La fecha de nacimiento es obligatoria.
        </span>
        <span *ngIf="form.get('fechaNacimiento')?.errors?.['underAge']">
          Debes ser mayor de 18 aÃ±os para registrarte.
        </span>
      </div>
    </div>

    <!-- DirecciÃ³n con autocompletado -->
    <div class="form-group" style="position: relative;">
      <label class="form-label">DirecciÃ³n *</label>
      <div class="input-container">
        <span class="input-icon">ğŸ“</span>
        <input #direccionInput type="text" class="form-input" placeholder="Escribe tu direcciÃ³n"
               autocomplete="off"
               (keydown.enter)="$event.preventDefault()"
               (input)="onDireccionInput(direccionInput.value)"
               (focus)="abrirSugerenciasSiHay()"
               (blur)="onDireccionBlur()"
               [value]="form.value.direccionDescripcion || ''"
               [class.invalid]="invalid('direccionDescripcion')" required>
      </div>
      <div class="error-text" *ngIf="invalid('direccionDescripcion')">La direcciÃ³n es obligatoria.</div>

      <ul class="sugerencias" *ngIf="mostrandoSugerencias">
        <li class="sugerencia-item" *ngFor="let s of sugerencias"
            (mousedown)="seleccionarSugerencia(s, direccionInput)">
          {{ s.display_name }}
        </li>
        <li class="sugerencia-atribucion">
          Resultados por Nominatim â€” Â© OpenStreetMap contributors
        </li>
      </ul>
    </div>

    <!-- Correo -->
    <div class="form-group">
      <label class="form-label">Correo electrÃ³nico *</label>
      <div class="input-container">
        <span class="input-icon">ğŸ“§</span>
        <input type="email" class="form-input" placeholder="tu@correo.com"
               formControlName="correo" [class.invalid]="invalid('correo')" required>
      </div>
      <div class="error-text" *ngIf="invalid('correo')">Ingresa un correo vÃ¡lido.</div>
    </div>

    <!-- TelÃ©fono (opcional) 
    <div class="form-group">
      <label class="form-label">TelÃ©fono (opcional)</label>
      <div class="input-container">
        <span class="input-icon">ğŸ“±</span>
        <input type="tel" class="form-input" placeholder="+56 9 1234 5678"
               formControlName="telefono">
      </div>
    </div>
    -->

    <!-- Passwords (grupo) -->
    <div formGroupName="passwordGroup">
      <div class="form-group">
        <label class="form-label">ContraseÃ±a *</label>
        <div class="input-container">
          <span class="input-icon">ğŸ”’</span>
          <input [type]="showPass ? 'text' : 'password'" class="form-input"
                 placeholder="ContraseÃ±a" formControlName="password" id="passwordInput"
                 [class.invalid]="form.get('passwordGroup.password')?.invalid && (form.get('passwordGroup.password')?.touched || form.get('passwordGroup.password')?.dirty)" required>
          <button type="button" class="password-toggle" (click)="togglePassword()">
            {{ showPass ? 'ğŸ™ˆ' : 'ğŸ‘' }}
          </button>
        </div>
        <div class="error-text"
             *ngIf="form.get('passwordGroup.password')?.invalid && (form.get('passwordGroup.password')?.touched || form.get('passwordGroup.password')?.dirty)">
          La contraseÃ±a es obligatoria (mÃ­nimo 6 caracteres).
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Repetir contraseÃ±a *</label>
        <div class="input-container">
          <span class="input-icon">ğŸ”’</span>
          <input [type]="showPass2 ? 'text' : 'password'" class="form-input"
                 placeholder="Repetir ContraseÃ±a" formControlName="repeatPassword" id="passwordRepeatInput"
                 [class.invalid]="(form.get('passwordGroup.repeatPassword')?.touched || form.get('passwordGroup.repeatPassword')?.dirty) && !passwordsMatch" required>
          <button type="button" class="password-toggle" (click)="togglePassword2()">
            {{ showPass2 ? 'ğŸ™ˆ' : 'ğŸ‘' }}
          </button>
        </div>
        <div class="error-text"
             *ngIf="form.get('passwordGroup')?.touched && form.get('passwordGroup')?.errors?.['passwordsMismatch']">
          Las contraseÃ±as no coinciden.
        </div>
      </div>
    </div>

    <!-- Tipo de usuario -->
    <div class="tipo-usuario-container">
      <label>Tipo de Usuario *:</label>
      <div class="form-check">
        <input class="form-check-input" type="radio" formControlName="tipoUsuario" value="proveedor" id="radioDefault1">
        <label class="form-check-label" for="radioDefault1">Proveedor</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" formControlName="tipoUsuario" value="solicitante" id="radioDefault2">
        <label class="form-check-label" for="radioDefault2">Solicitante</label>
      </div>
    </div>

    <br>
    <button type="submit" class="login-button" [disabled]="form.invalid">Registrarme</button>
    <br><br>
    <button type="button" class="cancel-button" (click)="routeLogin()">Cancelar</button>
  </form>
</div>
